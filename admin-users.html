<!DOCTYPE html>
<html>
<head>
    <title>User Management - Admin Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: #0f0f1e;
            color: white;
            padding: 20px;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        h1 { margin-bottom: 10px; }
        .subtitle { opacity: 0.8; }
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        button {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover { background: #764ba2; }
        table {
            width: 100%;
            background: #1a1a2e;
            border-radius: 10px;
            overflow: hidden;
        }
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #2a2a3e;
        }
        th {
            background: #2a2a3e;
            font-weight: 600;
        }
        tr:hover { background: #252540; }
        .status-active { color: #4CAF50; }
        .status-inactive { color: #f44336; }
        .actions { display: flex; gap: 10px; }
        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: #1a1a2e;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
        }
        input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background: #2a2a3e;
            border: 1px solid #3a3a4e;
            border-radius: 8px;
            color: white;
            font-size: 16px;
        }
        .loading { text-align: center; padding: 40px; opacity: 0.6; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üë• User Management</h1>
        <div class="subtitle">Manage beta testers and platform access</div>
    </div>

    <div class="controls">
        <button onclick="showAddUser()">‚ûï Add New User</button>
        <button onclick="loadUsers()">üîÑ Refresh</button>
        <button onclick="exportUsers()">üíæ Export CSV</button>
    </div>

    <div id="userTable">
        <div class="loading">Loading users...</div>
    </div>

    <!-- Add/Edit User Modal -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">Add New User</h2>
            <input type="text" id="userName" placeholder="Full Name">
            <input type="email" id="userEmail" placeholder="Email">
            <input type="text" id="userPin" placeholder="4-Digit PIN" maxlength="4">
            <input type="text" id="userPackage" placeholder="Package (e.g., Standard Beta)">
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="saveUser()">üíæ Save</button>
                <button onclick="closeModal()" style="background: #666;">‚ùå Cancel</button>
            </div>
        </div>
    </div>

    <script>
        const AIRTABLE_TOKEN = 'pat8DtOnZ1crQT56g.a83c21fa77ead56a661353b0cd0b286816ca14502ce717c8b247c0c52a326757';
        const AIRTABLE_BASE = 'app7F75X1uny6jPfd';
        const AIRTABLE_TABLE = 'Beta_Users';

        let users = [];
        let editingId = null;

        async function loadUsers() {
            try {
                const response = await fetch(
                    `https://api.airtable.com/v0/${AIRTABLE_BASE}/${AIRTABLE_TABLE}`,
                    {
                        headers: {
                            'Authorization': `Bearer ${AIRTABLE_TOKEN}`
                        }
                    }
                );

                const data = await response.json();
                users = data.records;
                renderTable();
            } catch (error) {
                document.getElementById('userTable').innerHTML =
                    `<div class="loading" style="color: #f44336;">‚ùå Error: ${error.message}</div>`;
            }
        }

        function renderTable() {
            const html = `
                <table>
                    <thead>
                        <tr>
                            <th>PIN</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Package</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${users.map(user => `
                            <tr>
                                <td><strong>${user.fields.PIN || 'N/A'}</strong></td>
                                <td>${user.fields.Name || ''}</td>
                                <td>${user.fields.Email || ''}</td>
                                <td>${user.fields.Package || ''}</td>
                                <td class="status-${(user.fields.Status || '').toLowerCase()}">${user.fields.Status || 'Unknown'}</td>
                                <td class="actions">
                                    <button class="btn-small" onclick="editUser('${user.id}')">‚úèÔ∏è Edit</button>
                                    <button class="btn-small" onclick="deleteUser('${user.id}')" style="background: #f44336;">üóëÔ∏è</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('userTable').innerHTML = html;
        }

        function showAddUser() {
            editingId = null;
            document.getElementById('modalTitle').textContent = 'Add New User';
            document.getElementById('userName').value = '';
            document.getElementById('userEmail').value = '';
            document.getElementById('userPin').value = '';
            document.getElementById('userPackage').value = '';
            document.getElementById('userModal').style.display = 'flex';
        }

        function editUser(id) {
            editingId = id;
            const user = users.find(u => u.id === id);
            if (!user) return;

            document.getElementById('modalTitle').textContent = 'Edit User';
            document.getElementById('userName').value = user.fields.Name || '';
            document.getElementById('userEmail').value = user.fields.Email || '';
            document.getElementById('userPin').value = user.fields.PIN || '';
            document.getElementById('userPackage').value = user.fields.Package || '';
            document.getElementById('userModal').style.display = 'flex';
        }

        async function saveUser() {
            const name = document.getElementById('userName').value;
            const email = document.getElementById('userEmail').value;
            const pin = document.getElementById('userPin').value;
            const pkg = document.getElementById('userPackage').value;

            if (!name || !email || !pin) {
                alert('Please fill in Name, Email, and PIN');
                return;
            }

            const data = {
                fields: {
                    Name: name,
                    Email: email,
                    PIN: pin,
                    Package: pkg,
                    Status: 'Active'
                }
            };

            try {
                if (editingId) {
                    // Update existing
                    await fetch(
                        `https://api.airtable.com/v0/${AIRTABLE_BASE}/${AIRTABLE_TABLE}/${editingId}`,
                        {
                            method: 'PATCH',
                            headers: {
                                'Authorization': `Bearer ${AIRTABLE_TOKEN}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(data)
                        }
                    );
                } else {
                    // Create new
                    await fetch(
                        `https://api.airtable.com/v0/${AIRTABLE_BASE}/${AIRTABLE_TABLE}`,
                        {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${AIRTABLE_TOKEN}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ records: [data] })
                        }
                    );
                }

                closeModal();
                loadUsers();
            } catch (error) {
                alert('Error saving user: ' + error.message);
            }
        }

        async function deleteUser(id) {
            if (!confirm('Delete this user?')) return;

            try {
                await fetch(
                    `https://api.airtable.com/v0/${AIRTABLE_BASE}/${AIRTABLE_TABLE}/${id}`,
                    {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${AIRTABLE_TOKEN}`
                        }
                    }
                );
                loadUsers();
            } catch (error) {
                alert('Error deleting user: ' + error.message);
            }
        }

        function closeModal() {
            document.getElementById('userModal').style.display = 'none';
        }

        function exportUsers() {
            const csv = [
                ['PIN', 'Name', 'Email', 'Package', 'Status'],
                ...users.map(u => [
                    u.fields.PIN || '',
                    u.fields.Name || '',
                    u.fields.Email || '',
                    u.fields.Package || '',
                    u.fields.Status || ''
                ])
            ].map(row => row.join(',')).join('\\n');

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'beta-users.csv';
            a.click();
        }

        // Load on start
        loadUsers();
    </script>

<!-- Universal HUD - Auto-injected -->
<script src="/UNIVERSAL_AI_HUD.js"></script>


<!-- üîç VISITOR TRACKING & INTERCOM SYSTEM -->
<script src="/VISITOR_TRACKING_SNIPPET.js"></script>
    <script>

            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `bug_${Date.now()}.json`;
            a.click();
        });

        // Show success message
        alert('‚úÖ BUG REPORTED!\n\nThanks for reporting this bug. We check reports every couple hours and will fix it ASAP.\n\nYour feedback makes the platform better!');

        // Reset form
        document.getElementById('bug-report-form').reset();
        toggleBugPanel();
    };
})();
</script>


    <script src="UNIVERSAL_ANALYTICS_TRACKER.js"></script>
</body> tag -->




    <!-- Simple Bug Reporter -->
    <script src="/SIMPLE_BUG_REPORTER.js"></script>

    <script src="/UNIVERSAL_USER_DISPLAY.js"></script>
    <script src="UNIVERSAL_ANALYTICS_TRACKER.js"></script>
</body>
</html>
