<!DOCTYPE html>
<html>
<head>
    <title>Bug Reports Viewer</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
        }
        h1 {
            color: #ff4444;
        }
        .bug-entry {
            background: #2a2a2a;
            border-left: 4px solid #ff4444;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .bug-entry .timestamp {
            color: #888;
            font-size: 12px;
        }
        .bug-entry .user {
            color: #00ff88;
            font-weight: bold;
        }
        .bug-entry .text {
            margin-top: 8px;
            color: #fff;
            line-height: 1.6;
        }
        .stats {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .copy-btn {
            background: #ff4444;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .copy-btn:hover {
            background: #ff6666;
        }
        .empty {
            color: #888;
            text-align: center;
            padding: 40px;
        }
    </style>
</head>
<body>
    <h1>üêõ Bug Reports Dashboard</h1>

    <div class="stats">
        <div>Total Bugs: <strong id="total-count">0</strong></div>
        <div style="margin-top: 10px;">
            <button class="copy-btn" onclick="copyAllBugs()">Copy All Bugs to Clipboard</button>
            <button class="copy-btn" onclick="clearAllBugs()">Clear All Bugs</button>
            <button class="copy-btn" onclick="downloadBugs()">Download as File</button>
        </div>
    </div>

    <div id="bugs-container"></div>

    <script>
        function loadBugs() {
            // Get all bug data from localStorage
            const kindergartenBugs = localStorage.getItem('kindergarten_bugs') || '';
            const simpleBugs = localStorage.getItem('simple_bugs') || '';
            const allBugsText = kindergartenBugs + simpleBugs;

            if (!allBugsText.trim()) {
                document.getElementById('bugs-container').innerHTML = '<div class="empty">No bugs reported yet</div>';
                return;
            }

            // Parse bug entries
            const lines = allBugsText.split('\n').filter(line => line.trim());
            document.getElementById('total-count').textContent = lines.length;

            // Display bugs
            const container = document.getElementById('bugs-container');
            container.innerHTML = '';

            lines.forEach(line => {
                // Parse format: [timestamp] [user] description
                const match = line.match(/\[(.*?)\] \[(.*?)\] (.*)/);
                if (match) {
                    const [_, timestamp, user, text] = match;
                    const div = document.createElement('div');
                    div.className = 'bug-entry';
                    div.innerHTML = `
                        <div class="timestamp">${new Date(timestamp).toLocaleString()}</div>
                        <div class="user">${user}</div>
                        <div class="text">${text}</div>
                    `;
                    container.appendChild(div);
                }
            });
        }

        function copyAllBugs() {
            const kindergartenBugs = localStorage.getItem('kindergarten_bugs') || '';
            const simpleBugs = localStorage.getItem('simple_bugs') || '';
            const allBugs = kindergartenBugs + simpleBugs;

            if (!allBugs.trim()) {
                alert('No bugs to copy');
                return;
            }

            navigator.clipboard.writeText(allBugs).then(() => {
                alert('‚úÖ All bugs copied to clipboard!');
            });
        }

        function clearAllBugs() {
            if (!confirm('Are you sure you want to clear ALL bug reports?')) return;

            localStorage.removeItem('kindergarten_bugs');
            localStorage.removeItem('simple_bugs');
            localStorage.removeItem('bugReports'); // old format

            alert('‚úÖ All bugs cleared!');
            loadBugs();
        }

        function downloadBugs() {
            const kindergartenBugs = localStorage.getItem('kindergarten_bugs') || '';
            const simpleBugs = localStorage.getItem('simple_bugs') || '';
            const allBugs = kindergartenBugs + simpleBugs;

            if (!allBugs.trim()) {
                alert('No bugs to download');
                return;
            }

            const blob = new Blob([allBugs], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bugs_${Date.now()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Load bugs on page load
        loadBugs();

        // Auto-refresh every 5 seconds
        setInterval(loadBugs, 5000);
    </script>

    <!-- Simple Bug Reporter -->
    <script src="/SIMPLE_BUG_REPORTER.js"></script>

    <script src="/UNIVERSAL_USER_DISPLAY.js"></script>
</body>
</html>
