// DEAD SIMPLE BUG REPORTER - NO DEPENDENCIES
(function() {
    'use strict';

    // Wait for DOM to be ready
    function init() {
        // Get page name from URL
        const getPageName = () => {
            const path = window.location.pathname;
            const page = path.split('/').pop() || 'Homepage';
            return page.replace('.html', '').replace(/-/g, ' ').replace(/_/g, ' ')
                       .split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
        };

        // Create button
        const btn = document.createElement('button');
    btn.innerHTML = 'üêõ';
    btn.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: #ff4444;
        color: white;
        border: none;
        font-size: 24px;
        cursor: pointer;
        z-index: 999999;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    `;

    // Create modal
    const modal = document.createElement('div');
    modal.style.cssText = `
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.8);
        z-index: 9999999;
        align-items: center;
        justify-content: center;
    `;

    modal.innerHTML = `
        <div style="background: #1a1a2e; padding: 2rem; border-radius: 12px; max-width: 500px; width: 90%;">
            <h3 style="color: #00ff88; margin-bottom: 1rem;">Report Bug</h3>
            <div style="background: rgba(0, 255, 136, 0.1); border: 1px solid #00ff88; border-radius: 6px; padding: 0.8rem; margin-bottom: 1rem;">
                <div style="color: #888; font-size: 12px; margin-bottom: 0.3rem;">üìç Reporting from:</div>
                <div id="bugPageName" style="color: #00ff88; font-weight: bold; font-size: 14px;">${getPageName()}</div>
                <div style="color: #666; font-size: 11px; margin-top: 0.3rem; word-break: break-all;">${window.location.href}</div>
            </div>
            <textarea id="bugDesc" placeholder="What's broken?" style="width: 100%; height: 100px; padding: 0.5rem; border-radius: 6px; border: 2px solid #00ff88; background: #0a0a0a; color: #fff; font-size: 14px; font-family: sans-serif; box-sizing: border-box;"></textarea>
            <div id="bugStatus" style="color: #00ff88; margin-top: 0.5rem; min-height: 20px;"></div>
            <div style="margin-top: 1rem; display: flex; gap: 1rem;">
                <button id="bugCancel" style="flex: 1; padding: 0.8rem; border: 2px solid #666; background: transparent; color: #ccc; border-radius: 6px; cursor: pointer; font-size: 14px;">Cancel</button>
                <button id="bugSubmit" style="flex: 1; padding: 0.8rem; border: none; background: #00ff88; color: #000; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 14px;">Submit</button>
            </div>
        </div>
    `;

    // Add to page
    document.body.appendChild(btn);
    document.body.appendChild(modal);

    // Show modal
    btn.onclick = () => {
        modal.style.display = 'flex';
        document.getElementById('bugDesc').focus();
    };

    // Hide modal
    document.getElementById('bugCancel').onclick = () => {
        modal.style.display = 'none';
        document.getElementById('bugDesc').value = '';
        document.getElementById('bugStatus').textContent = '';
    };

    // Submit bug
    document.getElementById('bugSubmit').onclick = async () => {
        const desc = document.getElementById('bugDesc').value.trim();
        const status = document.getElementById('bugStatus');

        if (!desc) {
            status.textContent = 'Please describe the bug';
            status.style.color = '#ff4444';
            return;
        }

        try {
            const response = await fetch('/.netlify/functions/web-bug-report', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    description: desc,
                    reporter: localStorage.getItem('workspace_user_name') || 'Anonymous',
                    page: window.location.href,
                    pageName: getPageName()
                })
            });

            if (response.ok) {
                status.textContent = '‚úÖ Bug reported!';
                status.style.color = '#00ff88';
                setTimeout(() => {
                    modal.style.display = 'none';
                    document.getElementById('bugDesc').value = '';
                    status.textContent = '';
                }, 1500);
            } else {
                throw new Error('Failed');
            }
        } catch (e) {
            status.textContent = '‚ùå Error - try again';
            status.style.color = '#ff4444';
        }
    };
    }

    // Run when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
})();
