<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profiles & Activity</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 2px solid #00ff88;
        }

        h1 {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .tagline {
            font-size: 1.3em;
            color: #00ff88;
        }

        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .filter-btn {
            padding: 12px 30px;
            border-radius: 8px;
            border: 2px solid rgba(0, 255, 136, 0.3);
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn.active {
            background: #00ff88;
            color: #000;
            border-color: #00ff88;
        }

        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .user-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 25px;
            border: 3px solid rgba(0, 255, 136, 0.3);
            transition: all 0.3s;
        }

        .user-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.3);
        }

        .user-card.builder {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.05);
        }

        .user-card.whiner {
            border-color: #ff4444;
            background: rgba(255, 68, 68, 0.05);
        }

        .user-card.unknown {
            border-color: #888;
            background: rgba(136, 136, 136, 0.05);
        }

        .user-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .user-name {
            font-size: 1.4em;
            font-weight: bold;
        }

        .classification {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .classification.BUILDER {
            background: #00ff88;
            color: #000;
        }

        .classification.EMERGING_BUILDER {
            background: #00ccff;
            color: #000;
        }

        .classification.WHINER {
            background: #ff4444;
            color: #fff;
        }

        .classification.POTENTIAL_WHINER {
            background: #ff8800;
            color: #000;
        }

        .classification.UNKNOWN {
            background: #888;
            color: #fff;
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            color: #888;
        }

        .activity-section {
            margin-top: 20px;
        }

        .section-title {
            font-size: 1.1em;
            color: #00ff88;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .activity-list {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
        }

        .activity-item {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .build-item {
            background: rgba(0, 255, 136, 0.1);
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
            border-left: 3px solid #00ff88;
        }

        .build-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .build-desc {
            font-size: 0.9em;
            color: #aaa;
        }

        .view-details-btn {
            width: 100%;
            padding: 10px;
            background: #00ff88;
            color: #000;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
        }

        .view-details-btn:hover {
            background: #00cc6f;
            transform: translateY(-2px);
        }

        .no-data {
            text-align: center;
            color: #666;
            padding: 40px;
            font-size: 1.2em;
        }

        .leaderboard {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #00ff88;
        }

        .leaderboard-title {
            font-size: 2em;
            color: #00ff88;
            margin-bottom: 20px;
            text-align: center;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .rank {
            font-size: 2em;
            font-weight: bold;
            color: #00ff88;
            width: 60px;
        }

        .rank.gold {
            color: #ffd700;
        }

        .rank.silver {
            color: #c0c0c0;
        }

        .rank.bronze {
            color: #cd7f32;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üë• User Profiles & Activity</h1>
            <p class="tagline">Track everyone: builders, whiners, Araya conversations, tokens, builds</p>
        </header>

        <!-- Leaderboard -->
        <div class="leaderboard">
            <div class="leaderboard-title">üèÜ Builder Leaderboard</div>
            <div id="leaderboard">
                <div class="no-data">Loading leaderboard...</div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters">
            <button class="filter-btn active" onclick="filterUsers('all')">All Users</button>
            <button class="filter-btn" onclick="filterUsers('BUILDER')">Builders</button>
            <button class="filter-btn" onclick="filterUsers('WHINER')">Whiners</button>
            <button class="filter-btn" onclick="filterUsers('UNKNOWN')">Unknown</button>
        </div>

        <!-- Users Grid -->
        <div class="users-grid" id="usersGrid">
            <div class="no-data">Loading user profiles...</div>
        </div>
    </div>

    <script>
        const ARAYA_API = 'http://localhost:6666';
        let allUsers = [];
        let currentFilter = 'all';

        // Load user data from Araya API
        async function loadUsers() {
            try {
                const response = await fetch(`${ARAYA_API}/users/all`);
                const data = await response.json();
                allUsers = data.users || [];

                displayUsers();
                displayLeaderboard();
            } catch (error) {
                console.error('Error loading users:', error);
                // Show demo data if API fails
                allUsers = [
                    {
                        user_id: 'demo_user',
                        name: 'Demo User (No Araya running)',
                        classification: 'UNKNOWN',
                        builder_score: 0,
                        whiner_score: 0,
                        total_score: 0,
                        builds_count: 0,
                        builds: [],
                        araya_conversations_count: 0,
                        tokens_used: 0,
                        actions_count: 0
                    }
                ];
                displayUsers();
                displayLeaderboard();
            }
        }

        function displayUsers() {
            const grid = document.getElementById('usersGrid');
            const filtered = filterUsersList();

            if (filtered.length === 0) {
                grid.innerHTML = '<div class="no-data">No users found</div>';
                return;
            }

            grid.innerHTML = '';

            filtered.forEach(user => {
                const card = createUserCard(user);
                grid.appendChild(card);
            });
        }

        function filterUsersList() {
            if (currentFilter === 'all') {
                return allUsers;
            }

            return allUsers.filter(u => {
                if (currentFilter === 'BUILDER') {
                    return u.classification.includes('BUILDER');
                } else if (currentFilter === 'WHINER') {
                    return u.classification.includes('WHINER');
                } else {
                    return u.classification === currentFilter;
                }
            });
        }

        function createUserCard(user) {
            const div = document.createElement('div');
            const cardClass = user.classification.includes('BUILDER') ? 'builder' :
                             user.classification.includes('WHINER') ? 'whiner' : 'unknown';

            div.className = `user-card ${cardClass}`;
            div.innerHTML = `
                <div class="user-header">
                    <div class="user-name">${user.name}</div>
                    <div class="classification ${user.classification}">${user.classification.replace('_', ' ')}</div>
                </div>

                <div class="stats-row">
                    <div class="stat">
                        <div class="stat-value">${user.total_score}</div>
                        <div class="stat-label">Total Score</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${user.builds_count}</div>
                        <div class="stat-label">Builds</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${user.araya_conversations_count}</div>
                        <div class="stat-label">Araya Chats</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${user.tokens_used.toLocaleString()}</div>
                        <div class="stat-label">Tokens Used</div>
                    </div>
                </div>

                ${user.builds && user.builds.length > 0 ? `
                    <div class="activity-section">
                        <div class="section-title">üèóÔ∏è Recent Builds</div>
                        <div>
                            ${user.builds.slice(0, 3).map(build => `
                                <div class="build-item">
                                    <div class="build-name">${build.name}</div>
                                    <div class="build-desc">${build.description}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}

                <button class="view-details-btn" onclick="viewUserDetails('${user.user_id}')">
                    View Full Profile
                </button>
            `;

            return div;
        }

        function displayLeaderboard() {
            const leaderboard = document.getElementById('leaderboard');
            const topUsers = [...allUsers].sort((a, b) => b.total_score - a.total_score).slice(0, 5);

            if (topUsers.length === 0) {
                leaderboard.innerHTML = '<div class="no-data">No users yet</div>';
                return;
            }

            leaderboard.innerHTML = '';

            topUsers.forEach((user, index) => {
                const div = document.createElement('div');
                div.className = 'leaderboard-item';

                const rankClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : '';

                div.innerHTML = `
                    <div class="rank ${rankClass}">#${index + 1}</div>
                    <div style="flex: 1;">
                        <div style="font-weight: bold; font-size: 1.2em;">${user.name}</div>
                        <div style="color: #888; font-size: 0.9em;">${user.classification.replace('_', ' ')}</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 1.5em; font-weight: bold; color: #00ff88;">${user.total_score}</div>
                        <div style="color: #888; font-size: 0.9em;">${user.builds_count} builds</div>
                    </div>
                `;

                leaderboard.appendChild(div);
            });
        }

        function filterUsers(filter) {
            currentFilter = filter;

            // Update button states
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            displayUsers();
        }

        function viewUserDetails(userId) {
            const user = allUsers.find(u => u.user_id === userId);
            if (user) {
                alert(`Full Profile: ${user.name}\n\nScore: ${user.total_score}\nClassification: ${user.classification}\n\n(Full profile viewer coming soon!)`);
            }
        }

        // Initialize
        loadUsers();

        // Auto-refresh every 30 seconds
        setInterval(loadUsers, 30000);
    </script>

<!-- üîç VISITOR TRACKING & INTERCOM SYSTEM -->
<script src="/VISITOR_TRACKING_SNIPPET.js"></script>

<!-- üéÆ UNIVERSAL HUD - Auto-injected -->
<script src="/universal-hud-embed.js"></script>
    <script>

            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `bug_${Date.now()}.json`;
            a.click();
        });

        // Show success message
        alert('‚úÖ BUG REPORTED!\n\nThanks for reporting this bug. We check reports every couple hours and will fix it ASAP.\n\nYour feedback makes the platform better!');

        // Reset form
        document.getElementById('bug-report-form').reset();
        toggleBugPanel();
    };
})();
</script>


</body> tag -->




    <!-- Simple Bug Reporter -->
    <script src="/SIMPLE_BUG_REPORTER.js"></script>

    <script src="/UNIVERSAL_USER_DISPLAY.js"></script>
</body>
</html>
